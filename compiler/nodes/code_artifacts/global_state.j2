{# Template for generating the Global State TypedDict class with per-node tracking #}
class GlobalState(TypedDict):
    """Global state shared across all nodes in the workflow."""
{%- for field_name, field_type in state_schema.items() %}
    {%- if field_name == "count" %}
    {{ field_name }}: Annotated[int, operator.add]  # Reducer: accumulate increments
    {%- else %}
    {{ field_name }}: {{ field_type }}
    {%- endif %}
{%- endfor %}
{%- for node_id in llm_node_ids %}
    # Node {{ node_id }} tracking
    node_{{ node_id }}_messages: Annotated[List[BaseMessage], lambda x, y: x + y]
    node_{{ node_id }}_llm_calls: Annotated[int, operator.add]  # Reducer: accumulate increments
    node_{{ node_id }}_tool_iteration_count: int  # Direct set, no accumulation
{%- endfor %}
{%- for node_id in worker_node_ids %}
    # Worker Node {{ node_id }} tracking
    node_{{ node_id }}_messages: Annotated[List[BaseMessage], lambda x, y: x + y]
    node_{{ node_id }}_llm_calls: Annotated[int, operator.add]  # Reducer: accumulate increments
    node_{{ node_id }}_tool_iteration_count: int  # Direct set, no accumulation
{%- endfor %}
    # Router tracking
    routing_reason: Optional[str]
